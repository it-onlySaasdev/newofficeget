name: Deploy to Skynet

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Upload to Skynet via Node.js
      run: |
        # Install skynet-js and upload directly
        echo "Installing Skynet SDK..."
        npm install --no-save skynet-js
        
        # Create upload script with CORRECT syntax
        cat > upload.js << 'EOF'
        const { SkynetClient } = require('skynet-js');
        const fs = require('fs');
        const path = require('path');
        
        const client = new SkynetClient("https://siasky.net");
        
        async function uploadDirectory() {
          try {
            console.log('Uploading directory to Skynet...');
            
            // CORRECT SYNTAX: Upload the entire current directory
            const skylink = await client.uploadDirectory("./");
            
            console.log('âœ… Upload successful!');
            console.log('ğŸŒ Live URL: https://siasky.net/' + skylink);
            console.log('ğŸ”— Skylink: ' + skylink);
            
          } catch (error) {
            console.error('âŒ Upload failed:', error);
            process.exit(1);
          }
        }
        
        uploadDirectory();
        EOF
        
        # Run the upload script
        node upload.js